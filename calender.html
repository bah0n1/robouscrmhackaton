<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CRM - Calendar</title>
    <!-- 1. Include Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- 2. Include Lucide Icon Library -->
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.min.js"></script>
    
    <!-- 3. Include FullCalendar Core and Plugins -->
    <script src='https://cdn.jsdelivr.net/npm/fullcalendar@6.1.11/index.global.min.js'></script>

    <style>
        /* Custom scrollbar */
        ::-webkit-scrollbar { width: 6px; height: 6px; }
        ::-webkit-scrollbar-track { background: #f1f1f1; }
        ::-webkit-scrollbar-thumb { background: #c1c1c1; border-radius: 6px; }
        ::-webkit-scrollbar-thumb:hover { background: #a1a1a1; }

        /* Ensure layout is fullscreen */
        html, body {
            height: 100%;
            overflow: hidden; /* Prevent body scroll */
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
        }
        
        /* Base styles for nav links */
        .nav-link {
            display: flex;
            align-items: center;
            padding: 0.75rem 1.5rem;
            margin: 0.25rem 1rem;
            border-radius: 0.375rem;
            color: #374151; /* gray-700 */
            font-weight: 500; /* medium */
            transition: all 0.2s ease-in-out;
        }
        .nav-link:hover {
            background-color: #f3f4f6; /* gray-100 */
            color: #111827; /* gray-900 */
        }
        .nav-link.active {
            background-color: #4f46e5; /* indigo-600 */
            color: #ffffff; /* white */
            box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1), 0 1px 2px 0 rgba(0, 0, 0, 0.06);
        }
        
        /* Base button styles */
        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            padding: 0.5rem 1rem;
            border-radius: 0.375rem;
            font-weight: 500;
            font-size: 0.875rem;
            line-height: 1.25rem;
            cursor: pointer;
            transition: background-color 0.2s ease;
            border: 1px solid transparent;
        }
        .btn-primary {
            background-color: #4f46e5; /* indigo-600 */
            color: #fff;
            border-color: #4f46e5;
        }
        .btn-primary:hover {
            background-color: #4338ca; /* indigo-700 */
        }
        .btn-secondary-outline {
            background-color: #fff;
            color: #374151; /* gray-700 */
            border-color: #d1d5db; /* gray-300 */
            box-shadow: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
        }
        .btn-secondary-outline:hover {
            background-color: #f9fafb; /* gray-50 */
        }
        .btn-secondary-outline.active {
            background-color: #f3f4f6; /* gray-100 */
            border-color: #d1d5db; /* gray-300 */
            box-shadow: inset 0 1px 2px 0 rgba(0, 0, 0, 0.05);
        }
        /* New style for icon-only buttons */
        .btn-icon {
            padding: 0.5rem; /* 8px padding for a square button */
        }
        
        /* Form inputs */
        .form-input, .form-select, .form-textarea {
            display: block;
            width: 100%;
            border-radius: 0.375rem;
            border: 1px solid #d1d5db; /* gray-300 */
            padding: 0.5rem 0.75rem;
            font-size: 0.875rem;
            line-height: 1.25rem;
        }
        .form-input:focus, .form-select:focus, .form-textarea:focus {
            outline: 2px solid transparent;
            outline-offset: 2px;
            border-color: #4f46e5; /* indigo-600 */
            box-shadow: 0 0 0 2px #c7d2fe; /* indigo-200 */
        }
        
        /* Modal styles */
        .modal {
            display: none; /* Hidden by default */
            position: fixed;
            z-index: 50;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0, 0, 0, 0.4);
            transition: opacity 0.2s ease-in-out;
        }
        .modal-content {
            background-color: #fefefe;
            margin: 10% auto;
            padding: 2rem;
            border-radius: 0.5rem;
            width: 90%;
            max-width: 500px;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            transform: translateY(-20px);
            transition: all 0.2s ease-in-out;
        }
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }
        .modal-title {
            font-size: 1.25rem;
            font-weight: 600;
            color: #111827;
        }
        .modal-close {
            color: #aaa;
            font-size: 1.75rem;
            font-weight: bold;
            cursor: pointer;
        }
        .modal-close:hover,
        .modal-close:focus {
            color: #000;
            text-decoration: none;
        }

        /* FullCalendar Customizations */
        :root {
            --fc-border-color: #e5e7eb; /* gray-200 */
            --fc-daygrid-event-dot-width: 6px;
            --fc-event-bg-color: #4f46e5; /* indigo-600 */
            --fc-event-border-color: #4f46e5;
            --fc-event-text-color: #fff;
            --fc-event-border-radius: 4px;
            --fc-today-bg-color: #f9fafb; /* gray-50 */
            --fc-button-bg-color: #fff;
            --fc-button-border-color: #d1d5db; /* gray-300 */
            --fc-button-text-color: #374151; /* gray-700 */
            --fc-button-hover-bg-color: #f3f4f6; /* gray-100 */
            --fc-button-active-bg-color: #e5e7eb; /* gray-200 */
        }
        .fc {
            height: 100%;
            font-size: 0.875rem;
        }
        .fc .fc-toolbar-title {
            font-size: 1.5rem;
            font-weight: 600;
        }
        .fc .fc-daygrid-day-number {
            padding: 0.5rem;
            font-weight: 500;
        }
        .fc .fc-daygrid-day.fc-day-today {
            background-color: #f0f9ff; /* light blue */
        }
        .fc .fc-event {
            padding: 2px 4px;
            font-size: 0.75rem;
            font-weight: 500;
        }
        /* Color event types */
        .fc-event.event-meeting { background-color: #4f46e5; border-color: #4f46e5; } /* indigo */
        .fc-event.event-call { background-color: #059669; border-color: #059669; } /* emerald */
        .fc-event.event-task { background-color: #db2777; border-color: #db2777; } /* pink */

    </style>
</head>
<body class="bg-gray-50">

    <div class="flex h-screen bg-white">
        <!-- Sidebar Navigation -->
       <!-- Sidebar Navigation -->
        <nav class="w-64 flex-shrink-0 border-r border-gray-200 bg-white flex flex-col">
            <div class="h-16 flex-shrink-0 flex items-center justify-center border-b border-gray-200">
                <h2 class="text-2xl font-bold text-indigo-600">ApexCRM</h2>
            </div>
            <div class="flex-grow overflow-y-auto">
                <ul class="py-4">
                    <!-- Main Navigation -->
                    <li><a href="/index.html" class="nav-link " data-page="page-dashboard"><i data-lucide="layout-dashboard" class="w-5 h-5 mr-3"></i>Dashboard</a></li>
                    
                    <!-- Sales Group -->
                    <li class="px-6 mt-4 mb-2 text-xs font-semibold text-gray-500 uppercase tracking-wider">Sales</li>
                    <li><a href="/contacts.html" class="nav-link" data-page="page-contact-list"><i data-lucide="users" class="w-5 h-5 mr-3"></i>Contacts</a></li>
                    <li><a href="/companies.html" class="nav-link" data-page="page-company-list"><i data-lucide="building-2" class="w-5 h-5 mr-3"></i>Companies</a></li>
                    <li><a href="/deals_pipeline.html" class="nav-link" data-page="page-deal-pipeline"><i data-lucide="kanban" class="w-5 h-5 mr-3"></i>Deals Pipeline</a></li>
                    
                    <!-- Service Group -->
                    <li class="px-6 mt-4 mb-2 text-xs font-semibold text-gray-500 uppercase tracking-wider">Service</li>
                    <li><a href="/supportticket.html" class="nav-link" data-page="page-ticket-list"><i data-lucide="life-buoy" class="w-5 h-5 mr-3"></i>Support Tickets</a></li>
                    
                    <!-- Marketing Group -->
                    <li class="px-6 mt-4 mb-2 text-xs font-semibold text-gray-500 uppercase tracking-wider">Marketing</li>
                    <li><a href="/campaigns.html" class="nav-link" data-page="page-campaign-list"><i data-lucide="send" class="w-5 h-5 mr-3"></i>Campaigns</a></li>
                    
                    <!-- Analytics & Tools -->
                    <li class="px-6 mt-4 mb-2 text-xs font-semibold text-gray-500 uppercase tracking-wider">Analytics & Tools</li>
                    <li><a href="/reports.html" class="nav-link" data-page="page-reports"><i data-lucide="pie-chart" class="w-5 h-5 mr-3"></i>Reports</a></li>
                    <li><a href="/automation.html" class="nav-link" data-page="page-automation"><i data-lucide="zap" class="w-5 h-5 mr-3"></i>Automation</a></li>
                    <li><a href="/calender.html" class="nav-link active" data-page="page-calendar"><i data-lucide="calendar" class="w-5 h-5 mr-3"></i>Calendar</a></li>
                </ul>
            </div>
            <a href="/profile.html" class="block" data-page="page-calendar">
    <div class="flex-shrink-0 p-4 border-t border-gray-200 hover:bg-gray-50">
        <div class="flex items-center">
            <img class="w-10 h-10 rounded-full" src="https://placehold.co/40x40/93c5fd/FFFFFF?text=A" alt="Alex Johnson">
            <div class="ml-3">
                <p class="text-sm font-medium text-gray-900">Alex Johnson</p>
                <p class="text-xs text-gray-500">Sales Manager</p>
            </div>
        </div>
    </div>
</a>
        </nav>

        <!-- Main Content Area -->
        <main class="flex-1 flex flex-col overflow-hidden">
            <!-- Page Header -->
            <div class="h-16 flex-shrink-0 flex items-center justify-between px-6 border-b border-gray-200">
                <!-- MODIFIED: Added calendar title and nav buttons -->
                <div class="flex items-center gap-4">
                    <h1 id="calendar-title" class="text-2xl font-bold text-gray-900">Calendar</h1>
                    <div class="flex items-center rounded-md shadow-sm border border-gray-300">
                        <button id="btn-prev" class="btn btn-secondary-outline btn-icon rounded-r-none border-r-0">
                            <i data-lucide="chevron-left" class="w-5 h-5"></i>
                        </button>
                        <button id="btn-today" class="btn btn-secondary-outline rounded-none border-r-0">Today</button>
                        <button id="btn-next" class="btn btn-secondary-outline btn-icon rounded-l-none">
                            <i data-lucide="chevron-right" class="w-5 h-5"></i>
                        </button>
                    </div>
                </div>
                <div class="flex items-center gap-4">
                    <div class="flex items-center rounded-md shadow-sm border border-gray-300">
                        <button id="btn-month-view" class="btn btn-secondary-outline active rounded-r-none border-r-0">Month</button>
                        <button id="btn-week-view" class="btn btn-secondary-outline rounded-none border-r-0">Week</button>
                        <button id="btn-day-view" class="btn btn-secondary-outline rounded-l-none">Day</button>
                    </div>
                    <button id="add-event-btn" class="btn btn-primary">
                        <i data-lucide="plus" class="w-4 h-4 mr-2"></i> Add Event
                    </button>
                </div>
            </div>

            <!-- Calendar Container -->
            <div class="flex-1 p-6 overflow-y-auto">
                <div id="calendar-container" class="h-full">
                    <div id="calendar"></div>
                </div>
            </div>
        </main>
    </div>

    <!-- Event Modal -->
    <div id="event-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="event-modal-title" class="modal-title">Add New Event</h3>
                <span id="modal-close-btn" class="modal-close">&times;</span>
            </div>
            <form id="event-form" class="space-y-4">
                <input type="hidden" id="event-id">
                
                <div>
                    <label for="event-title" class="block text-sm font-medium text-gray-700">Event Title</label>
                    <input type="text" id="event-title" class="form-input mt-1" required>
                </div>
                
                <div>
                    <label for="event-type" class="block text-sm font-medium text-gray-700">Event Type</label>
                    <select id="event-type" class="form-select mt-1">
                        <option value="meeting">Meeting</option>
                        <option value="call">Call</option>
                        <option value="task">Task</option>
                    </select>
                </div>

                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label for="event-start-date" class="block text-sm font-medium text-gray-700">Start Date</label>
                        <input type="date" id="event-start-date" class="form-input mt-1" required>
                    </div>
                    <div>
                        <label for="event-start-time" class="block text-sm font-medium text-gray-700">Start Time</label>
                        <input type="time" id="event-start-time" class="form-input mt-1" step="900">
                    </div>
                </div>

                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label for="event-end-date" class="block text-sm font-medium text-gray-700">End Date</label>
                        <input type="date" id="event-end-date" class="form-input mt-1">
                    </div>
                    <div>
                        <label for="event-end-time" class="block text-sm font-medium text-gray-700">End Time</label>
                        <input type="time" id="event-end-time" class="form-input mt-1" step="900">
                    </div>
                </div>
                
                <div class="flex justify-between items-center pt-4">
                    <button type="button" id="delete-event-btn" class="btn" style="color: #ef4444; background: transparent;">
                        <i data-lucide="trash-2" class="w-4 h-4 mr-2"></i> Delete
                    </button>
                    <button type="submit" id="save-event-btn" class="btn btn-primary">Save Event</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            lucide.createIcons();

            // --- MOCK DATABASE ---
            const db = {
                events: [
                    {
                        id: 'evt1',
                        title: 'Team Standup',
                        start: '2025-11-05T09:00:00',
                        end: '2025-11-05T09:15:00',
                        className: 'event-task'
                    },
                    {
                        id: 'evt2',
                        title: 'Follow-up Call with Jane Smith',
                        start: '2025-11-06T11:00:00',
                        end: '2025-11-06T11:30:00',
                        className: 'event-call'
                    },
                    {
                        id: 'evt3',
                        title: 'Proposal Review with Tech Solutions',
                        start: '2025-11-07T14:00:00',
                        end: '2025-11-07T15:00:00',
                        className: 'event-meeting'
                    },
                    // Add a recurring event
                    {
                        id: 'evt4',
                        title: 'Weekly Sales Sync',
                        startTime: '10:00:00',
                        endTime: '11:00:00',
                        daysOfWeek: [ '2' ], // '2' is Tuesday
                        startRecur: '2025-11-01',
                        endRecur: '2025-12-31',
                        className: 'event-meeting'
                    }
                ]
            };
            
            // --- CALENDAR TITLE ELEMENT ---
            const calendarTitle = document.getElementById('calendar-title');

            // --- FULLCALENDAR INITIALIZATION ---
            let calendarEl = document.getElementById('calendar');
            let calendar = new FullCalendar.Calendar(calendarEl, {
                initialView: 'dayGridMonth',
                headerToolbar: false, // We use our own buttons
                events: function(fetchInfo, successCallback, failureCallback) {
                    // Simulate fetching events
                    successCallback(db.events);
                },
                editable: true,       // Allow drag-and-drop
                selectable: true,     // Allow clicking and dragging
                dayMaxEvents: true,   // Allow "more" link when too many events

                // --- EVENT HANDLERS ---
                
                // Click on a day or time slot
                select: function(info) {
                    openEventModal('add');
                    // Pre-fill dates
                    document.getElementById('event-start-date').value = formatDate(info.start, 'date');
                    document.getElementById('event-start-time').value = formatDate(info.start, 'time');
                    document.getElementById('event-end-date').value = formatDate(info.end, 'date');
                    document.getElementById('event-end-time').value = formatDate(info.end, 'time');
                },

                // Click on an existing event
                eventClick: function(info) {
                    openEventModal('edit', info.event);
                },

                // When an event is dragged and dropped
                eventDrop: function(info) {
                    updateEventInDB(info.event);
                },
                
                // When an event is resized
                eventResize: function(info) {
                    updateEventInDB(info.event);
                }
            });
            calendar.render();
            
            // --- INITIAL TITLE SET ---
            updateCalendarTitle();

            // --- MODAL HANDLING ---
            const eventModal = document.getElementById('event-modal');
            const addEventBtn = document.getElementById('add-event-btn');
            const closeModalBtn = document.getElementById('modal-close-btn');
            const eventForm = document.getElementById('event-form');
            const eventIdInput = document.getElementById('event-id');
            const eventModalTitle = document.getElementById('event-modal-title');
            const deleteEventBtn = document.getElementById('delete-event-btn');

            function openEventModal(mode = 'add', event = null) {
                eventForm.reset();
                eventIdInput.value = '';
                
                if (mode === 'edit' && event) {
                    eventModalTitle.textContent = 'Edit Event';
                    deleteEventBtn.style.display = 'block';

                    eventIdInput.value = event.id;
                    document.getElementById('event-title').value = event.title;
                    document.getElementById('event-type').value = event.className.replace('event-', '');

                    if (event.start) {
                        document.getElementById('event-start-date').value = formatDate(event.start, 'date');
                        document.getElementById('event-start-time').value = formatDate(event.start, 'time');
                    }
                    if (event.end) {
                        document.getElementById('event-end-date').value = formatDate(event.end, 'date');
                        document.getElementById('event-end-time').value = formatDate(event.end, 'time');
                    }

                } else {
                    eventModalTitle.textContent = 'Add New Event';
                    deleteEventBtn.style.display = 'none';
                }
                
                eventModal.style.display = 'block';
                setTimeout(() => { 
                    eventModal.style.opacity = 1;
                    eventModal.querySelector('.modal-content').style.transform = 'translateY(0)';
                }, 10);
            }

            function closeModal() {
                eventModal.style.opacity = 0;
                eventModal.querySelector('.modal-content').style.transform = 'translateY(-20px)';
                setTimeout(() => { eventModal.style.display = 'none'; }, 200);
            }

            addEventBtn.onclick = () => openEventModal('add');
            closeModalBtn.onclick = closeModal;
            window.onclick = function(event) {
                if (event.target == eventModal) {
                    closeModal();
                }
            }
            
            // --- FORM SUBMISSION ---
            eventForm.addEventListener('submit', function(e) {
                e.preventDefault();
                
                const id = eventIdInput.value;
                const title = document.getElementById('event-title').value;
                const type = document.getElementById('event-type').value;
                const startDate = document.getElementById('event-start-date').value;
                const startTime = document.getElementById('event-start-time').value;
                const endDate = document.getElementById('event-end-date').value;
                const endTime = document.getElementById('event-end-time').value;

                // Combine date and time
                const start = `${startDate}T${startTime || '00:00:00'}`;
                const end = `${endDate || startDate}T${endTime || '00:00:00'}`;

                const eventData = {
                    title: title,
                    start: start,
                    end: end,
                    className: `event-${type}`
                };

                if (id) {
                    // Update existing event
                    const index = db.events.findIndex(e => e.id === id);
                    if (index > -1) {
                        db.events[index] = { ...db.events[index], ...eventData };
                    }
                } else {
                    // Create new event
                    eventData.id = `evt${new Date().getTime()}`;
                    db.events.push(eventData);
                }

                calendar.refetchEvents();
                closeModal();
            });
            
            // Delete event
            deleteEventBtn.onclick = function() {
                const id = eventIdInput.value;
                if (id && confirm('Are you sure you want to delete this event?')) {
                    db.events = db.events.filter(e => e.id !== id);
                    calendar.refetchEvents();
                    closeModal();
                }
            }
            
            // --- VIEW SWITCHER & NAVIGATION ---
            const viewButtons = [
                { id: 'btn-month-view', view: 'dayGridMonth' },
                { id: 'btn-week-view', view: 'timeGridWeek' },
                { id: 'btn-day-view', view: 'timeGridDay' }
            ];
            
            viewButtons.forEach(btnConfig => {
                document.getElementById(btnConfig.id).addEventListener('click', () => {
                    calendar.changeView(btnConfig.view);
                    updateCalendarTitle(); // Update title on view change
                    // Update active class
                    viewButtons.forEach(b => document.getElementById(b.id).classList.remove('active'));
                    document.getElementById(btnConfig.id).classList.add('active');
                });
            });

            // NEW: Add click handlers for navigation
            document.getElementById('btn-prev').addEventListener('click', () => {
                calendar.prev();
                updateCalendarTitle();
            });
            document.getElementById('btn-today').addEventListener('click', () => {
                calendar.today();
                updateCalendarTitle();
            });
            document.getElementById('btn-next').addEventListener('click', () => {
                calendar.next();
                updateCalendarTitle();
            });
            
            // --- UTILITY FUNCTIONS ---
            
            /**
             * NEW: Updates the h1 title with the calendar's current view title
             */
            function updateCalendarTitle() {
                if (calendarTitle) {
                    calendarTitle.textContent = calendar.view.title;
                }
            }

            /**
             * Formats a Date object into YYYY-MM-DD or HH:MM
             */
            function formatDate(date, type) {
                try {
                    const d = new Date(date);
                    if (isNaN(d.getTime())) return ''; // Invalid date

                    if (type === 'date') {
                        return d.toISOString().split('T')[0];
                    }
                    if (type === 'time') {
                        // Check if it's an all-day event (midnight)
                        if (d.getUTCHours() === 0 && d.getUTCMinutes() === 0) {
                            return ''; // Don't pre-fill time for all-day
                        }
                        return d.toTimeString().split(' ')[0].substring(0, 5); // HH:MM
                    }
                } catch (e) {
                    console.error("Error formatting date:", e);
                    return '';
                }
            }

            /**
             * Updates an event in the mock DB after drag/drop
             */
            function updateEventInDB(event) {
                const index = db.events.findIndex(e => e.id === event.id);
                if (index > -1) {
                    db.events[index].start = event.start.toISOString();
                    db.events[index].end = event.end ? event.end.toISOString() : null;
                    console.log("Event updated:", db.events[index]);
                }
            }
            
        });
    </script>
</body>
</html>

